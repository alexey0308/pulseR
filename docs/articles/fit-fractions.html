<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PulseR workflow • pulseR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">pulseR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/confidence.html">Profile likelihood</a>
    </li>
    <li>
      <a href="../articles/fit-fractions.html">PulseR workflow</a>
    </li>
    <li>
      <a href="../articles/formulas.html">Formula creation</a>
    </li>
    <li>
      <a href="../articles/spike-ins.html">PulseR with spike-ins</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dieterich-lab/pulseR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>PulseR workflow</h1>
                        <h4 class="author">Alexey Uvarovskii</h4>
            
            <h4 class="date">2017-07-04</h4>
          </div>

    
    
<div class="contents">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pulseR)</code></pre></div>
<pre><code>## 
## Attaching package: 'pulseR'</code></pre>
<pre><code>## The following object is masked from 'package:stats':
## 
##     profile</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">258</span>)</code></pre></div>
<div id="prepare-a-data-set-and-conditions" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-a-data-set-and-conditions" class="anchor"></a>Prepare a data set and conditions</h2>
<div id="the-experiment-description" class="section level3">
<h3 class="hasAnchor">
<a href="#the-experiment-description" class="anchor"></a>The experiment description</h3>
<p>Let us have a labelling experiment with several time points</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attach</span>(pulseRFractionData)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">formulas &lt;-<span class="st"> </span><span class="kw"><a href="../reference/MeanFormulas.html">MeanFormulas</a></span>(<span class="dt">A =</span> a <span class="op">*</span><span class="st"> </span>p,
                         <span class="dt">B =</span>  a <span class="op">*</span><span class="st"> </span>b <span class="op">^</span><span class="st"> </span>time,
                         <span class="dt">C =</span> a <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>b <span class="op">^</span><span class="st"> </span>time))</code></pre></div>
<p>Here is the condition matrix for our data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conditions</code></pre></div>
<pre><code>##            condition time
## sample_1  A_fraction    1
## sample_2  A_fraction    2
## sample_3  A_fraction    3
## sample_4  B_fraction    1
## sample_5  B_fraction    2
## sample_6  B_fraction    3
## sample_7  C_fraction    1
## sample_8  C_fraction    2
## sample_9  C_fraction    3
## sample_10 A_fraction    1
## sample_11 A_fraction    2
## sample_12 A_fraction    3
## sample_13 B_fraction    1
## sample_14 B_fraction    2
## sample_15 B_fraction    3
## sample_16 C_fraction    1
## sample_17 C_fraction    2
## sample_18 C_fraction    3
## sample_19 A_fraction    1
## sample_20 A_fraction    2
## sample_21 A_fraction    3
## sample_22 B_fraction    1
## sample_23 B_fraction    2
## sample_24 B_fraction    3
## sample_25 C_fraction    1
## sample_26 C_fraction    2
## sample_27 C_fraction    3</code></pre>
</div>
</div>
<div id="create-pulsedata-object" class="section level2">
<h2 class="hasAnchor">
<a href="#create-pulsedata-object" class="anchor"></a>Create <code>PulseData</code> object</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PulseData.html">PulseData</a></span>(
  <span class="dt">counts =</span> counts,
  <span class="dt">conditions =</span> conditions,
  <span class="dt">formulas =</span> formulas,
  <span class="dt">formulaIndexes =</span> formulaIndexes,
  <span class="dt">groups =</span> fractions
)</code></pre></div>
<p>It is important to understand, how the data are normalised. To reduce parameter number, we use the same normalisation as in the DESeq package for samples from the <em>same fraction</em>. Strictly speaking, we define <em>fractions</em> as sets of samples, which have different amounts of RNA, estimated by the model.</p>
<div id="fitting-options" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-options" class="anchor"></a>Fitting options</h3>
<p>Now we set options for fitting. It is important to provide boundaries for the optimal parameter search:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">opts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setBoundaries.html">setBoundaries</a></span>(<span class="kw">list</span>(
  <span class="dt">a =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">1e6</span>),
  <span class="dt">b =</span> <span class="kw">c</span>(.<span class="dv">01</span>, .<span class="dv">99</span>),
  <span class="dt">normFactors =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="dv">50</span>)
))</code></pre></div>
<p>For other possible parameters please see “set” functions in the package documentation (<code>setBoundaries, setTolerance, setFittingOptions</code>).</p>
</div>
<div id="initial-parameter-guess" class="section level3">
<h3 class="hasAnchor">
<a href="#initial-parameter-guess" class="anchor"></a>Initial parameter guess</h3>
<p>Optimisation procedure may depend on the initial parameter values. A function <code>initParams</code> provides an interface to simplify this step. There are two options for how to set the parameters:</p>
<ul>
<li>to sample random numbers within the given boundaries</li>
<li>manual values by the user</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">initPars &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">p =</span> pulseRFractionData<span class="op">$</span>par<span class="op">$</span>p)
initPars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/initParameters.html">initParameters</a></span>(initPars, <span class="kw">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), <span class="dt">pulseData =</span> pd, <span class="dt">options =</span> opts)</code></pre></div>
</div>
</div>
<div id="fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting" class="anchor"></a>Fitting</h2>
<p>One can specify other options as the number of cores or error tolerance thresholds for parameter fitting. The fitting procedure will stop, once the difference in parameters values between two subsequent iteration is less than specified in <code>options$tolerance</code>.</p>
<p>The function <code>fitModel</code> accepts a PulseData object, an initial guess for the parameters values and fitting options.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">opts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setTolerance.html">setTolerance</a></span>(<span class="dt">params =</span> <span class="fl">1e-3</span>,
                     <span class="dt">normFactors =</span> <span class="fl">1e-2</span>,
                     <span class="dt">options =</span> opts)
result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitModel.html">fitModel</a></span>(pd, initPars, opts)</code></pre></div>
<p>The fitted result is a list of fitted parameter values as well as fixed parameters, if they were specified.</p>
<p>One may compare estimations for mean read numbers derived from the fitted parameters with the raw data (simulated counts in our case):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/predictExpression.html">predictExpression</a></span>(result, pd)

<span class="kw">plot</span>(
  <span class="dt">x =</span> <span class="kw">as.vector</span>(pr<span class="op">$</span>predictions),
  <span class="dt">y =</span> <span class="kw">as.vector</span>(pd<span class="op">$</span>counts),
  <span class="dt">pch =</span> <span class="dv">16</span>,
  <span class="dt">cex =</span> .<span class="dv">3</span>,
  <span class="dt">log =</span> <span class="st">'xy'</span>,
  <span class="dt">xlab =</span> <span class="st">"fitted"</span>,
  <span class="dt">ylab =</span> <span class="st">"experiment"</span>
  )</code></pre></div>
<p><img src="fit-fractions_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.4.0 (2017-04-21)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 14.04.5 LTS
## 
## Matrix products: default
## BLAS: /usr/lib/openblas-base/libblas.so.3
## LAPACK: /usr/lib/lapack/liblapack.so.3.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] pulseR_0.0.2
## 
## loaded via a namespace (and not attached):
##  [1] compiler_3.4.0   backports_1.0.5  magrittr_1.5     rprojroot_1.2   
##  [5] tools_3.4.0      htmltools_0.3.6  yaml_2.1.14      Rcpp_0.12.11    
##  [9] codetools_0.2-15 stringi_1.1.5    rmarkdown_1.6    knitr_1.16      
## [13] stringr_1.2.0    digest_0.6.12    evaluate_0.10.1</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prepare-a-data-set-and-conditions">Prepare a data set and conditions</a></li>
      <li><a href="#create-pulsedata-object">Create <code>PulseData</code> object</a></li>
      <li><a href="#fitting">Fitting</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alexey Uvarovskii.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
