<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create an object for pulse-change count data — PulseData • pulseR</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">pulseR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/confidence.html">Profile likelihood</a>
    </li>
    <li>
      <a href="../articles/formulas.html">Formula creation</a>
    </li>
    <li>
      <a href="../articles/workflow.html">The workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dieterich-lab/pulseR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create an object for pulse-change count data</h1>
    </div>

    
    <p>Create an object for pulse-change count data</p>
<p>Calculate normalisation factors for columns in a matrix</p>
<p>Estimate DESeq normalisation factors using spike-ins counts</p>
<p>Performs sequencing depth normalisation using the DESeq procedure.</p>
<p>Calculate normalisation factors</p>
<p>If, for example, a labelled fraction is estimated at several time points
(0hr, 2hr, 4hr), corresponding partially evaluated formulas will be
created. In this case, a time variable (e.g. "t") will be substituted by
its values from the corresponding column in the conditions data.frame.
Hence several partially evaluated formulas will be created for every
combination of variable values described in the conditions data.frame.</p>
<p>It is assumed that all samples in a group belong to the same condition,
i.e. the same equations are used to estimate expression levels.
However, they may correspond to different time points etc.</p>
<p>Create a test count data</p>
<p>A helper to generate named lists</p>
<p>If the same name is used for several items (e.g. "total"),
only first item is left in the result.</p>
    

    <pre class="usage"><span class='fu'>PulseData</span>(<span class='no'>counts</span>, <span class='no'>conditions</span>, <span class='no'>formulas</span>, <span class='kw'>formulaIndexes</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>spikeins</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>groups</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>findDeseqFactorsSingle</span>(<span class='no'>count_data</span>)

<span class='fu'>normaliseWithSpikeIns</span>(<span class='no'>pd</span>, <span class='no'>refGroup</span>, <span class='no'>spikeLists</span>)

<span class='fu'>normaliseNoSpikeins</span>(<span class='no'>pd</span>, <span class='no'>groups</span>)

<span class='fu'>findDeseqFactorsForFractions</span>(<span class='no'>count_data</span>, <span class='no'>conditions</span>)

<span class='fu'>addKnownToFormulas</span>(<span class='no'>formulas</span>, <span class='no'>formulaIndexes</span>, <span class='no'>conditions</span>)

<span class='fu'>makeGroups</span>(<span class='no'>pd</span>, <span class='no'>normGroups</span>)

<span class='fu'>generateTestDataFrom</span>(<span class='no'>formulas</span>, <span class='no'>formulaIndexes</span>, <span class='no'>normFactors</span>, <span class='no'>par</span>, <span class='no'>conditions</span>)

<span class='fu'>multiplyList</span>(<span class='no'>source</span>, <span class='no'>pattern</span>)

<span class='fu'>shrinkList</span>(<span class='no'>list</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>counts</th>
      <td><p>a matrix; column names correspond to sample names.
The columns in <code>counts</code> correspond to the rows in <code>conditions</code> argument.</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>a data.frame;
the first column corresponds to the conditions given in <code>formulas</code>.
The order of rows corresponds to the columns (samples) in the
<code>counts</code> argument.</p></td>
    </tr>
    <tr>
      <th>formulas</th>
      <td><p>a list, created by <code><a href='MeanFormulas.html'>MeanFormulas</a></code></p></td>
    </tr>
    <tr>
      <th>formulaIndexes</th>
      <td><p>a list of lists; defines indexes of formulas
used for calculation of the expected read number</p></td>
    </tr>
    <tr>
      <th>spikeins</th>
      <td><p>NULL (default) or a list of two items:</p><ul>
<li><p>refGroup, a character, which defines the group which should be
treated as a reference for normalisation</p></li>
<li><p>spikeLists, a list of character vectors with the spike-ins names and
the same structure as <code>formulaIndexes</code>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>groups</th>
      <td><p>NULL (default) or a formula or a vector,
e.g. ~ condition + time (if spike-ins are not provided).
The vector length must be the same as the sample number.
the names used in the <code>fractions</code> defines different fractions,
which should have distinct coefficients for mean expression fitting.</p></td>
    </tr>
    <tr>
      <th>count_data</th>
      <td><p>a matrix; columns correspond to samples.</p></td>
    </tr>
    <tr>
      <th>pd</th>
      <td><p>a <code>PulseData</code> object</p></td>
    </tr>
    <tr>
      <th>refGroup</th>
      <td><p>a character name of a sample groups to use as a reference.
The name must be present in the spikeLists names list</p></td>
    </tr>
    <tr>
      <th>spikeLists</th>
      <td><p>a named list with the same structure as formulaIndexes</p></td>
    </tr>
    <tr>
      <th>normGroups</th>
      <td><p>a vector defining a rule for splitting the samples in <code>pd</code></p></td>
    </tr>
    <tr>
      <th>normFactors</th>
      <td><p>list of vectors; normalisation factors, if
known</p></td>
    </tr>
    <tr>
      <th>par</th>
      <td><p>a list of named parameters; gene-specific parameters
are vectors</p></td>
    </tr>
    <tr>
      <th>source</th>
      <td><p>a named lists with the values to multiply</p></td>
    </tr>
    <tr>
      <th>pattern</th>
      <td><p>a vector of names defining how to construct a new
list (typically, a longer one with replicates).</p></td>
    </tr>
    <tr>
      <th>list</th>
      <td><p>a list to process</p></td>
    </tr>
    <tr>
      <th>pd</th>
      <td><p>a <code>PulseData</code> object</p></td>
    </tr>
    <tr>
      <th>groups</th>
      <td><p>a vector for splitting objects to groups</p></td>
    </tr>
    <tr>
      <th>count_data</th>
      <td><p>integer matrix, colnames correspond to samples
(rownames in <code>conditions</code>)</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>factors to split samples for normalisation</p></td>
    </tr>
    <tr>
      <th>formulas</th>
      <td><p>a named list with unevaluated expressions
for expression levels
(e.g. describing amounts of "labelled", "total" etc. RNA)</p></td>
    </tr>
    <tr>
      <th>formulaIndexes</th>
      <td><p>a list describing which formulas to use for
mean read number calculation for fractions defined by the names of list items</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>a data.frame with the first column corresponding to
names in formulasIndexes (e.g. "total", "pull_down")</p></td>
    </tr>
    <tr>
      <th>pd</th>
      <td><p>a <code>PulseData</code> object</p></td>
    </tr>
    <tr>
      <th>formulas</th>
      <td><p>a list</p></td>
    </tr>
    <tr>
      <th>formulaIndexes</th>
      <td><p>list of lists; defines indexes of formulas
used for calculation of the expected read number</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>a condition data.frame</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>an object of class "PulseData"</p>
<p>a vector of doubles with normalisation factors ordered as columns in
the <code>count_data</code></p>
<p>a list of lists of the normalisation coefficients for every sample</p>
<p>a vector with the coefficient for every sample</p>
<p>vector of double; normalisation factors in the same order as
columns in the <code>count_data</code></p>
<p>a list with two items:</p><ul>
<li><p>list of partially evaluated formulas</p></li>
<li><p>a vector of conditions generated from combination of columns</p></li>
</ul>

<p>a named list with items "normCoeffs" and "normCoeffIndexes".
normCoeffs is the list to store the values of the normalisation coefficients
for every group.
normCoeffIndexes stores indexes of coefficients from unlist(normCoeffs)
sample-wise, i.e. length(normCoeffIndexes) is the number of samples.</p>
<p>matrix of counts with the order of columns as in conditions</p>
<p>a list</p>
<p>a shorter list</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>conditions</code> argument may include additional  columns, which
provide values for known parameters, such as time. Their name must be the
same as defined in formulas. For example, if a formula is defined as
<code>mu * exp(-d * time)</code> where <code>time</code> is the time point of the experiment,
the condition data.frame must contain a column named <code>time</code>.</p>
<p>The returned normalisation coefficients are assign to 1.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Spike-ins definition for object creation</span>

<span class='no'>formulaIndexes</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
  <span class='kw'>total_fraction</span> <span class='kw'>=</span> <span class='st'>'total'</span>,
  <span class='kw'>flow_through</span>   <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>'unlabelled'</span>, <span class='st'>'labelled'</span>),
  <span class='kw'>pull_down</span>      <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>'labelled'</span>, <span class='st'>'unlabelled'</span>))

<span class='co'># spike-ins set up:</span>

<span class='no'>refGroup</span> <span class='kw'>&lt;-</span> <span class='st'>"total_fraction"</span>

<span class='no'>labelled</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"spike1"</span>, <span class='st'>"spike2"</span>)
<span class='no'>unlabelled</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"spike3"</span>, <span class='st'>"spike4"</span>)

<span class='no'>spikeLists</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
<span class='co'>#  total samples are normalised using all spike-ins</span>
  <span class='kw'>total_fraction</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>c</span>(<span class='no'>unlabelled</span>, <span class='no'>labelled</span>)),
<span class='co'># for every item in formulaIndexes we have a set of spike-ins:   </span>
  <span class='kw'>flow_through</span>   <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>unlabelled</span>, <span class='no'>labelled</span>),
  <span class='kw'>pull_down</span>      <span class='kw'>=</span> <span class='fu'>list</span>(<span class='no'>labelled</span>, <span class='no'>unlabelled</span>))

<span class='co'># argument for the function: </span>
<span class='no'>spikeins</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>refGroup</span> <span class='kw'>=</span> <span class='no'>refGroup</span>,
                 <span class='kw'>spikeLists</span> <span class='kw'>=</span> <span class='no'>spikeLists</span>)


<span class='no'>formulas</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='MeanFormulas.html'>MeanFormulas</a></span>(<span class='kw'>total</span> <span class='kw'>=</span> <span class='no'>m</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='no'>m</span> * <span class='fu'>exp</span>(-<span class='no'>d</span>*<span class='no'>t</span>))
<span class='no'>formulaIndexes</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
  <span class='kw'>total</span> <span class='kw'>=</span> <span class='st'>'total'</span>,
  <span class='kw'>pull_down</span> <span class='kw'>=</span> <span class='st'>'label'</span>
)
<span class='no'>conditions</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>'total'</span>, <span class='st'>'pull_down'</span>, <span class='st'>'pull_down'</span>),
  <span class='kw'>t</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>5</span>)
)
<span class='no'>result</span> <span class='kw'>&lt;-</span> <span class='fu'>addKnownToFormulas</span>(<span class='no'>formulas</span>, <span class='no'>formulaIndexes</span>, <span class='no'>conditions</span>)
<span class='fu'>str</span>(<span class='no'>result</span>)</div><div class='output co'>#&gt; List of 2
#&gt;  $ formulas      :List of 3
#&gt;   ..$ total.0: symbol m
#&gt;   ..$ label.1: language m * exp(-d * 1)
#&gt;   ..$ label.5: language m * exp(-d * 5)
#&gt;  $ formulaIndexes:List of 3
#&gt;   ..$ total.0    : int 1
#&gt;   ..$ pull_down.1: int 2
#&gt;   ..$ pull_down.5: int 3</div><div class='input'><span class='co'># List of 2</span>
<span class='co'># $ formulas      :List of 3</span>
<span class='co'># ..$ total.0: symbol m</span>
<span class='co'># ..$ label.1: language m * exp(-d * 1)</span>
<span class='co'># ..$ label.5: language m * exp(-d * 5)</span>
<span class='co'># $ formulaIndexes:List of 3</span>
<span class='co'># ..$ total.0    : int 1</span>
<span class='co'># ..$ pull_down.1: int 2</span>
<span class='co'># ..$ pull_down.5: int 3</span>

<span class='no'>source</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
  <span class='kw'>total</span>   <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>label</span>   <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>3</span>),
  <span class='kw'>unlabel</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>4</span>,<span class='fl'>5</span>))
<span class='no'>pattern</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"total"</span>, <span class='st'>"total"</span>, <span class='st'>"label"</span>, <span class='st'>"total"</span>, <span class='st'>"unlabel"</span>)
<span class='fu'>multiplyList</span>(<span class='no'>source</span>, <span class='no'>pattern</span>)</div><div class='output co'>#&gt; $total
#&gt; [1] 1
#&gt; 
#&gt; $total
#&gt; [1] 1
#&gt; 
#&gt; $label
#&gt; [1] 2 3
#&gt; 
#&gt; $total
#&gt; [1] 1
#&gt; 
#&gt; $unlabel
#&gt; [1] 4 5
#&gt; </div><div class='input'><span class='co'># $total</span>
<span class='co'># [1] 1</span>
<span class='co'># </span>
<span class='co'># $total</span>
<span class='co'># [1] 1</span>
<span class='co'># </span>
<span class='co'># $label</span>
<span class='co'># [1] 2 3</span>
<span class='co'># </span>
<span class='co'># $total</span>
<span class='co'># [1] 1</span>
<span class='co'># </span>
<span class='co'># $unlabel</span>
<span class='co'># [1] 4 5</span>
<span class='no'>l</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
  <span class='kw'>total</span>   <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>total</span>   <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>unlabel</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>4</span>,<span class='fl'>5</span>))
<span class='fu'>shrinkList</span>(<span class='no'>l</span>)</div><div class='output co'>#&gt; $total
#&gt; [1] 1
#&gt; 
#&gt; $unlabel
#&gt; [1] 4 5
#&gt; </div><div class='input'># $total
# [1] 1
# 
# $unlabel
# [1] 4 5

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Alexey Uvarovskii.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
