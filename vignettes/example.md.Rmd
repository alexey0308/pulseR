---
title: "PulseR workflow"
author: "Alexey Uvarovskii"
date: "`r Sys.Date()`"
output:
  html_vignette:
    keep_md: true
vignette: >
  %\VignetteIndexEntry{workflow}
  %\VignetteEngine{knitr::rmarkdown}
  \VignetteEncoding{UTF-8}
---

```{r}
set.seed(258)
library(pulseR)
```

## Prepare a data set and conditions

### The experiment

Let us have a labelling experiment with several time points
```{r}
replicateNum <- 3
time <- c(4,8,12)
geneNum <- 1000

```

```{r echo=TRUE}
formulas <- MeanFormulas(
  total = mu,
  lab   = mu * (1 - exp(-d * time))
)
conditions <- expand.grid(condition = names(formulas), time = time)
conditions <- conditions[rep(seq_along(conditions$time),
                             each = replicateNum),]
rownames(conditions) <- paste0("sample_", seq_along(conditions$condition))
knitr::kable(head(conditions))

```

Here we create parameters for `r geneNum` genes:
```{r}
fractions <- ~ time + condition
par <- list(size = 1e2)
par$params <- data.frame(mu = 10 ^ runif(geneNum, 0, 6),
                         d = -log(runif(geneNum, .1, .9)) / 12)
rownames(par$params) <- paste0("gene_", 1:geneNum)
fraction_names <- levels(codeFractions(conditions, fractions))
par$fraction_factors <- seq_along(fraction_names)
```

```{r}
counts <- generateTestDataFrom(formulas, par,
                               conditions,
                               fractions)
pd <- PulseData(
    count_data = counts,
    conditions = conditions,
    formulas   = formulas,
    fractions  = ~condition+time)
```
